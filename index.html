<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>InfoGram 2026 - Interactive Player</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- [ê¸°ë³¸ ì„¤ì •] --- */
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-main: #262626;
            --text-sub: #8e8e8e;
            --accent: #0095f6;
            --ai-color: #8e2de2;
            --ai-gradient: linear-gradient(to right, #4a00e0, #8e2de2);
            --new-badge: #ff3b30;
            --header-height: 130px; /* í—¤ë” + ê²€ìƒ‰ì°½ ë†’ì´ */
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            padding-bottom: 80px;
            overscroll-behavior-y: none;
        }

        /* --- [í—¤ë”] --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 2000;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-bottom: 1px solid #dbdbdb;
            display: flex; flex-direction: column; gap: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s ease; /* í—¤ë” ìˆ¨ê¹€ ì• ë‹ˆë©”ì´ì…˜ */
        }
        
        .header-top { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .logo-area { display: flex; align-items: center; gap: 8px; flex-shrink: 0; cursor: pointer; }
        .category-badge {
            background: var(--ai-gradient); color: #fff; padding: 4px 8px; 
            border-radius: 4px; font-size: 0.75rem; font-weight: bold; white-space: nowrap;
        }

        .header-actions { display: flex; align-items: center; gap: 12px; }
        .notification-icon { position: relative; font-size: 1.5rem; color: var(--text-main); cursor: pointer; }
        .notification-icon.alert { animation: bellShake 0.5s ease-in-out infinite; color: var(--new-badge); }
        .red-dot {
            position: absolute; top: -2px; right: -2px; width: 10px; height: 10px; 
            background: var(--new-badge); border-radius: 50%; border: 2px solid #fff; display: none; z-index: 10;
        }
        @keyframes bellShake { 
            0% { transform: rotate(0); } 25% { transform: rotate(15deg); } 
            50% { transform: rotate(0); } 75% { transform: rotate(-15deg); } 100% { transform: rotate(0); } 
        }

        .lang-selector {
            border: 1px solid #dbdbdb; padding: 5px 10px; border-radius: 20px;
            background: #fff; font-size: 0.85rem; cursor: pointer; outline: none; font-weight: 700;
            color: var(--text-main);
        }

        .search-container { width: 100%; position: relative; }
        .search-input {
            width: 100%; padding: 12px 15px 12px 40px; border-radius: 25px;
            border: 2px solid transparent; background: #fff; font-size: 0.95rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: 0.3s;
            background-image: linear-gradient(#fff, #fff), var(--ai-gradient);
            background-origin: border-box; background-clip: padding-box, border-box;
        }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #8e2de2; }

        /* --- [ê³ ì •í˜• ì¸í„°ë™í‹°ë¸Œ í”Œë ˆì´ì–´] --- */
        #fixedPlayer {
            position: fixed; 
            top: var(--header-height); /* ì´ˆê¸° ìœ„ì¹˜: í—¤ë” ì•„ë˜ */
            left: 0; width: 100%;
            z-index: 1900; /* í—¤ë”ë³´ë‹¤ ë‚®ì§€ë§Œ ë¦¬ìŠ¤íŠ¸ë³´ë‹¤ ë†’ìŒ */
            background: #000;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: top 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); /* ë¶€ë“œëŸ¬ìš´ ì´ë™ */
        }
        
        /* í”Œë ˆì´ì–´ê°€ ë§¨ ìœ„ë¡œ ì˜¬ë¼ê°”ì„ ë•Œ ì ìš©ë  í´ë˜ìŠ¤ */
        #fixedPlayer.sticky-top {
            top: 0 !important;
            z-index: 2100; /* í—¤ë” ìœ„ë¡œ ì˜¬ë¼ì˜´ */
            border-bottom: 1px solid #333;
        }

        .video-container {
            position: relative; width: 100%; padding-bottom: 56.25%; background: #000;
        }
        .video-container iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;
        }

        /* ì»¨íŠ¸ë¡¤ ë°” (ì œìŠ¤ì²˜ ì˜ì—­) */
        .player-controls {
            background: #1a1a1a; color: #fff; padding: 12px 15px;
            display: flex; justify-content: space-between; align-items: center;
            cursor: grab; touch-action: none; /* ë¸Œë¼ìš°ì € ìŠ¤í¬ë¡¤ ë°©ì§€í•˜ê³  ì œìŠ¤ì²˜ ìš°ì„  */
            border-top: 1px solid #333;
        }
        .player-info { flex: 1; overflow: hidden; display: flex; flex-direction: column; justify-content: center; }
        .player-handle { 
            width: 40px; height: 4px; background: rgba(255,255,255,0.3); 
            border-radius: 2px; margin: 0 auto 8px auto; /* ì¤‘ì•™ ìƒë‹¨ í•¸ë“¤ë°” */
        }
        .player-title { font-size: 0.95rem; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .close-player-btn {
            background: rgba(255,255,255,0.1); border: none; color: #fff;
            width: 32px; height: 32px; border-radius: 50%; cursor: pointer;
            display: flex; align-items: center; justify-content: center; margin-left: 10px;
        }

        /* --- [í”¼ë“œ] --- */
        .feed-container { 
            max-width: 600px; margin: 140px auto 0; /* í—¤ë” ë†’ì´ë§Œí¼ ì—¬ë°± */
            min-height: 100vh; padding: 0 10px; 
            transition: margin-top 0.3s ease;
        }
        
        .card {
            background: var(--card-bg); border: none; border-radius: 12px;
            overflow: hidden; margin-bottom: 25px; transition: transform 0.2s; position: relative; cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .card:active { transform: scale(0.98); }
        
        .card-header { padding: 12px 15px; display: flex; align-items: center; gap: 10px; }
        .source-icon { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; border: 1px solid #eee; flex-shrink: 0; }
        .source-info { flex: 1; overflow: hidden; }
        .source-name { font-weight: 700; font-size: 14px; white-space: nowrap; }
        .time-stamp { font-size: 12px; color: var(--text-sub); }
        .card-new-badge {
            position: absolute; top: 10px; right: 10px; z-index: 5;
            background: var(--new-badge); color: #fff; padding: 4px 8px;
            border-radius: 4px; font-size: 0.75rem; font-weight: bold;
        }
        
        .card-media { width: 100%; aspect-ratio: 16/9; background: #000; overflow: hidden; position: relative; }
        .card-media img { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; display: block; opacity: 0.9; }
        
        .card-body { padding: 15px; }
        .card-title { font-size: 1.1rem; font-weight: 800; margin-bottom: 8px; line-height: 1.4; color: #111; }
        .card-desc { font-size: 0.9rem; color: #555; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* AI ê²°ê³¼ ë°•ìŠ¤ */
        .ai-result-box {
            max-width: 600px; margin: 140px auto 0; padding: 0;
            background: #fff; border-radius: 16px; border: 1px solid #e1e1e1;
            display: none; box-shadow: 0 10px 30px rgba(142, 45, 226, 0.1); overflow: hidden;
        }
        .ai-header-area {
            padding: 15px 20px; border-bottom: 1px solid #f0f0f0;
            display: flex; align-items: center; justify-content: space-between;
            background: linear-gradient(to right, #fdfbfb, #ebedee);
        }
        .ai-title-group { display: flex; align-items: center; gap: 10px; color: var(--ai-color); font-weight: 800; }
        .ai-loader { width: 18px; height: 18px; border: 3px solid #f3f3f3; border-top: 3px solid var(--ai-color); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .ai-body { padding: 20px; font-size: 0.95rem; line-height: 1.6; color: #444; }

    </style>
</head>
<body>

    <header id="mainHeader">
        <div class="header-top">
            <div class="logo-area" onclick="location.reload()">
                <i class="fas fa-brain" style="color:#8e2de2; font-size: 1.6rem;"></i>
                <span style="font-weight:900; font-size:1.3rem; letter-spacing:-0.5px;">InfoGram</span>
                <span class="category-badge">AI</span>
            </div>
            
            <div class="header-actions">
                <div class="notification-icon" id="bellIcon" onclick="applyRealUpdate()">
                    <i class="far fa-bell"></i>
                    <div class="red-dot" id="notiDot"></div>
                </div>
                <select class="lang-selector" id="langSelect" onchange="changeLanguage()">
                    <option value="ko">KR</option>
                    <option value="en">EN</option>
                    <option value="jp">JP</option>
                </select>
            </div>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" id="searchInput" placeholder="Search..." onkeyup="handleSearch(event)">
        </div>
    </header>

    <div id="fixedPlayer">
        <div class="video-container" id="playerFrameArea"></div>
        <div class="player-controls" id="playerControls">
            <div class="player-info">
                <div class="player-handle"></div> <span class="player-title" id="playerTitle">Video Title</span>
            </div>
            <button class="close-player-btn" onclick="closePlayer()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <div id="aiResult" class="ai-result-box">
        <div class="ai-header-area">
            <div class="ai-title-group">
                <div class="ai-loader" id="aiLoader"></div>
                <i class="fas fa-magic" id="aiIcon" style="display:none;"></i>
                <span id="aiTitle">AI Searching...</span>
            </div>
        </div>
        <div class="ai-body" id="aiContent"></div>
    </div>

    <div class="feed-container" id="feedContainer"></div>

    <script>
        const YOUTUBE_API_KEY = 'AIzaSyBlKZbCP6qZiv3NLBmgh4iled9Y4BmCUM8'; 
        const API_URL = 'https://www.googleapis.com/youtube/v3/search';
        let currentLang = 'ko';
        let lastQuery = '';

        // --- 1. ê²€ìƒ‰ ë° AI ---
        async function handleSearch(e) {
            if (e.key === 'Enter' || e.type === 'click') {
                const query = document.getElementById('searchInput').value;
                if (!query) return;
                lastQuery = query;

                closePlayer(); 
                document.getElementById('feedContainer').style.marginTop = '140px'; 
                
                resetUI(query);
                generateAIAnalysis(query);
                await searchYouTubeReal(query);
            }
        }

        function resetUI(query) {
            const aiBox = document.getElementById('aiResult');
            aiBox.style.display = 'block';
            document.getElementById('aiLoader').style.display = 'inline-block';
            document.getElementById('aiIcon').style.display = 'none';
            document.getElementById('aiTitle').innerText = `Analyzing '${query}'...`;
            document.getElementById('aiContent').innerText = '';
            document.getElementById('feedContainer').innerHTML = `<div style="text-align:center; padding:20px; color:#888;">Searching Global DB...</div>`;
        }

        function generateAIAnalysis(query) {
            setTimeout(() => {
                document.getElementById('aiLoader').style.display = 'none';
                document.getElementById('aiIcon').style.display = 'inline-block';
                const now = new Date();
                const dateStr = `${now.getFullYear()}.${now.getMonth()+1}.${now.getDate()}`;
                let text = "";
                if (currentLang === 'ko') {
                    document.getElementById('aiTitle').innerText = `AI ì¸ì‚¬ì´íŠ¸`;
                    text = `<strong>ğŸ“… ${dateStr} ê¸°ì¤€ ë¶„ì„</strong><br><b>${query}</b> ê´€ë ¨ ìµœì‹  ì˜ìƒì…ë‹ˆë‹¤. ì˜ìƒ í•˜ë‹¨ ë°”ë¥¼ ìœ„ë¡œ ì˜¬ë¦¬ë©´ í™”ë©´ ìƒë‹¨ì— ê³ ì •ë©ë‹ˆë‹¤.`;
                } else {
                    document.getElementById('aiTitle').innerText = `AI Insight`;
                    text = `<strong>ğŸ“… Analysis for ${dateStr}</strong><br>Latest videos for <b>${query}</b>. Swipe up the player bar to stick to top.`;
                }
                document.getElementById('aiContent').innerHTML = text;
            }, 1000);
        }

        // --- 2. ìœ íŠœë¸Œ API ---
        async function searchYouTubeReal(query) {
            try {
                const url = `${API_URL}?part=snippet&maxResults=10&q=${encodeURIComponent(query)}&type=video&key=${YOUTUBE_API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                renderFeed(data.items);
            } catch (error) {
                console.warn("API Error:", error);
                renderFeed([]); 
            }
        }

        function renderFeed(items, prepend = false) {
            const container = document.getElementById('feedContainer');
            if(!prepend) container.innerHTML = ''; 

            if(!items || items.length === 0) {
                if(!prepend) container.innerHTML = '<div style="text-align:center; padding:20px;">No results found.</div>';
                return;
            }

            items.forEach(item => {
                const videoId = item.id.videoId || 'HK6y8DAPN_0'; 
                const title = item.snippet.title;
                const desc = item.snippet.description;
                const thumbnail = item.snippet.thumbnails.medium.url;
                const channel = item.snippet.channelTitle;
                const badge = prepend ? `<div class="card-new-badge">LIVE</div>` : '';

                const card = document.createElement('div');
                card.className = 'card';
                card.setAttribute('onclick', `playVideo('${videoId}', "${escapeHtml(title)}")`);
                
                card.innerHTML = `
                    ${badge}
                    <div class="card-header">
                        <div style="width:36px; height:36px; background:#eee; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; color:#555;">${channel.substring(0,1)}</div>
                        <div class="source-info"><div class="source-name">${channel}</div><div class="time-stamp">Just now</div></div>
                    </div>
                    <div class="card-media">
                        <img src="${thumbnail}" alt="Thumbnail">
                        <i class="fas fa-play-circle" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:50px; color:rgba(255,255,255,0.9);"></i>
                    </div>
                    <div class="card-body">
                        <div class="card-title">${title}</div>
                        <div class="card-desc">${desc}</div>
                    </div>
                `;
                
                if(prepend) container.prepend(card);
                else container.appendChild(card);
            });
        }

        // --- 3. [í•µì‹¬] í”Œë ˆì´ì–´ ë¡œì§ (ìœ„ì¹˜ ì œì–´) ---
        function playVideo(videoId, title) {
            const player = document.getElementById('fixedPlayer');
            const frameArea = document.getElementById('playerFrameArea');
            const feed = document.getElementById('feedContainer');
            const aiBox = document.getElementById('aiResult');
            const header = document.getElementById('mainHeader');

            // í”Œë ˆì´ì–´ ì´ˆê¸°í™” ë° í‘œì‹œ
            player.style.display = 'block';
            player.classList.remove('sticky-top'); // ì²˜ìŒì—” í—¤ë” ì•„ë˜
            document.getElementById('playerTitle').innerText = title;

            // ì˜ìƒ ì¬ìƒ (Autoplay + Mute)
            frameArea.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&playsinline=1&rel=0&controls=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;

            // ë ˆì´ì•„ì›ƒ ë°€ì–´ë‚´ê¸° (í”Œë ˆì´ì–´ ë†’ì´ë§Œí¼)
            // í—¤ë”(130) + í”Œë ˆì´ì–´(ì•½ 280) + ì—¬ìœ 
            const offset = 130 + player.offsetHeight + 20;
            feed.style.marginTop = `${offset}px`; 
            if(aiBox.style.display === 'block') aiBox.style.marginTop = `${offset}px`;
            
            // ë§¨ ìœ„ë¡œ ì´ë™
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function closePlayer() {
            const player = document.getElementById('fixedPlayer');
            const feed = document.getElementById('feedContainer');
            const aiBox = document.getElementById('aiResult');

            document.getElementById('playerFrameArea').innerHTML = ''; // ì˜ìƒ ë„ê¸°
            player.style.display = 'none';
            player.classList.remove('sticky-top');

            // ë ˆì´ì•„ì›ƒ ë³µêµ¬
            feed.style.marginTop = '140px'; 
            aiBox.style.marginTop = '140px';
        }

        // --- [ì œìŠ¤ì²˜ & ìŠ¤í¬ë¡¤ ì œì–´] ---
        const controls = document.getElementById('playerControls');
        let startY = 0;

        // ì»¨íŠ¸ë¡¤ ë°” í„°ì¹˜ ì‹œì‘
        controls.addEventListener('touchstart', e => { startY = e.touches[0].clientY; }, {passive: true});

        // ì»¨íŠ¸ë¡¤ ë°” í„°ì¹˜ ë (ìœ„/ì•„ë˜ íŒë³„)
        controls.addEventListener('touchend', e => {
            const endY = e.changedTouches[0].clientY;
            const diff = startY - endY;
            const player = document.getElementById('fixedPlayer');

            if (diff > 50) { 
                // ìœ„ë¡œ ë°€ê¸° -> Top ê³ ì •
                player.classList.add('sticky-top');
            } else if (diff < -50) { 
                // ì•„ë˜ë¡œ ë°€ê¸° -> ì›ë˜ ìœ„ì¹˜
                player.classList.remove('sticky-top');
            }
        }, {passive: true});

        // ìŠ¤í¬ë¡¤ ë™ê¸°í™” (ë¦¬ìŠ¤íŠ¸ë¥¼ ë‚´ë¦¬ë©´ í”Œë ˆì´ì–´ë„ ì˜¬ë¼ê°)
        window.addEventListener('scroll', () => {
            const player = document.getElementById('fixedPlayer');
            if(player.style.display !== 'block') return;

            // ìŠ¤í¬ë¡¤ì´ ì¡°ê¸ˆ ë°œìƒí•˜ë©´ ìë™ìœ¼ë¡œ Top ëª¨ë“œë¡œ ì „í™˜ (ìì—°ìŠ¤ëŸ¬ìš´ UX)
            if (window.scrollY > 100) {
                player.classList.add('sticky-top');
            } else if (window.scrollY < 10) {
                player.classList.remove('sticky-top');
            }
        });

        // --- 4. ê¸°íƒ€ ìœ í‹¸ ---
        function changeLanguage() {
            currentLang = document.getElementById('langSelect').value;
            const searchInput = document.getElementById('searchInput');
            searchInput.placeholder = currentLang === 'ko' ? "ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." : "Search...";
            if(lastQuery) generateAIAnalysis(lastQuery);
        }

        function applyRealUpdate() {
            const bell = document.getElementById('bellIcon');
            const dot = document.getElementById('notiDot');
            bell.classList.remove('alert');
            dot.style.display = 'none';
            
            const mockItem = {
                id: { videoId: 'HK6y8DAPN_0' },
                snippet: {
                    title: currentLang === 'ko' ? "ğŸ”´ [ì†ë³´] AI ë‰´ìŠ¤ ë¼ì´ë¸Œ" : "ğŸ”´ [BREAKING] AI News Live",
                    description: "Live updates.",
                    thumbnails: { medium: { url: "https://images.unsplash.com/photo-1620712943543-bcc4688e7485?auto=format&fit=crop&q=80&w=800" } },
                    channelTitle: "Live",
                    publishedAt: new Date().toISOString()
                }
            };
            renderFeed([mockItem], true); 
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        setInterval(() => {
            const bell = document.getElementById('bellIcon');
            const dot = document.getElementById('notiDot');
            bell.classList.add('alert');
            dot.style.display = 'block';
            setTimeout(() => { bell.classList.remove('alert'); }, 3000);
        }, 15000);

        function escapeHtml(text) { return text ? text.replace(/['"]/g, "") : ""; }

        searchYouTubeReal("Tech Trends 2026");
    </script>
</body>
</html>
